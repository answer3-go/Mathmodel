### **问题二：最优单枚烟幕弹投放策略建模**

#### **1. 问题重述**

本问题的核心目标是：为单架无人机（FY1）规划其**飞行策略**和**投放时机**，以投放一枚烟幕弹对抗来袭的导弹（M1），使得该烟幕弹对真目标的**有效遮蔽总时长达到最大**。需要确定的关键参数包括无人机的飞行速度、飞行方向，以及烟幕弹的投放时刻和引信起爆时间。

#### **2. 模型假设**

为使问题简化且可解，我们做出以下合理假设：

1. **运动模型简化**: 各物体（导弹、无人机、烟幕弹、烟幕云）的运动严格遵循题目描述的理想化物理模型（匀速直线、抛体运动、匀速下沉）。
2. **遮蔽判定简化**: 将被保护的真目标（半径7m，高10m的圆柱体）简化为其几何中心点 `(0, 200, 5)` 进行保护。当导弹与该点的连线被烟幕云球体遮挡时，即视为有效遮蔽。
3. **瞬时形成与均匀性**: 烟幕弹起爆后瞬时形成半径为10m的均匀球状烟幕云团，该云团在此后20秒内均具有有效遮蔽能力。
4. **环境因素忽略**: 忽略空气阻力、风速等环境因素对各物体运动轨迹的影响。

#### **3. 符号说明**

| 符号                 | 含义                               | 单位 |
| :------------------- | :--------------------------------- | :--- |
| $\vec{x}$          | 决策变量向量                       | -    |
| $v$                | 无人机飞行速度大小                 | m/s  |
| $\alpha$           | 无人机水平飞行方向角               | 度   |
| $t_{drop}$         | 烟幕弹投放时刻                     | s    |
| $\Delta t_{delay}$ | 烟幕弹引信延迟时间                 | s    |
| $T_{total}$        | 有效遮蔽总时长                     | s    |
| $f(\vec{x})$       | 目标函数，即$T_{total}(\vec{x})$ | s    |
| $\vec{P}(t)$       | 物体在时刻$t$ 的位置向量         | m    |
| $\vec{v}$          | 物体的速度向量                     | m/s  |
| $t_{detonate}$     | 烟幕弹起爆时刻                     | s    |
| $V(t, \vec{x})$    | 时刻$t$ 的遮蔽状态函数           | 0或1 |

#### **4. 模型建立**

这是一个典型的**非线性优化问题**。我们将构建一个包含决策变量、目标函数和约束条件的完整优化模型。

##### **4.1 决策变量 (Decision Variables)**

为完整描述一套策略，我们需要确定四个核心参数，构成决策变量向量 $\vec{x}$：

$$
\vec{x} = [v, \alpha, t_{drop}, \Delta t_{delay}]
$$

##### **4.2 目标函数 (Objective Function)**

我们的优化目标是最大化有效遮蔽总时长 $T_{total}$。$T_{total}$ 是一个依赖于决策变量 $\vec{x}$ 的函数，我们将其定义为目标函数 $f(\vec{x})$。

$$
\text{Maximize: } f(\vec{x}) = T_{total}(\vec{x})
$$

$T_{total}(\vec{x})$ 的计算基于对一个**遮蔽状态函数 $V(t, \vec{x})$** 的积分。$V(t, \vec{x})$ 定义如下：

$$
V(t, \vec{x}) =
\begin{cases}
1, & \text{若在时刻 } t \text{，由策略 } \vec{x} \text{ 产生的烟幕云形成了有效遮蔽} \\
0, & \text{否则}
\end{cases}
$$

有效遮蔽总时长的数学表达为：

$$
T_{total}(\vec{x}) = \int_{0}^{t_{end}} V(t, \vec{x}) \,dt
$$

由于 $V(t, \vec{x})$ 是一个复杂的、通过物理仿真才能确定的函数，我们采用**数值积分**的方法，将时间离散化为步长 $\Delta t$ 的微小片段进行求和：

$$
T_{total}(\vec{x}) \approx \sum_{i=0}^{N} V(t_i, \vec{x}) \cdot \Delta t
$$

其中，$t_i = i \cdot \Delta t$。而 $V(t_i, \vec{x})$ 的值，则由我们建立的**时空运动模型**和**遮蔽判定模型**共同决定。

**a) 时空运动模型**:

* **无人机速度向量**: $\vec{v}_{uav}(\vec{x}) = (v \cdot \cos(\alpha_{rad}), v \cdot \sin(\alpha_{rad}), 0)$
* **烟幕弹起爆点位置**: $\vec{P}_{detonate}(\vec{x}) = \vec{P}_{uav}(t_{drop}) + \vec{v}_{uav}(\vec{x}) \cdot \Delta t_{delay} + \frac{1}{2} \vec{g} \cdot (\Delta t_{delay})^2$
* **烟幕云心位置** (for $t \ge t_{detonate}$): $\vec{P}_{cloud}(t, \vec{x}) = \vec{P}_{detonate}(\vec{x}) + \vec{v}_{cloud} \cdot (t - (t_{drop} + \Delta t_{delay}))$
* **导弹位置**: $\vec{P}_{missile}(t)$ （与策略无关，计算方法同问题一）

**b) 遮蔽判定模型**:
在任意时刻 $t_i$，当且仅当以下两个条件**同时满足**时，$V(t_i, \vec{x}) = 1$：

1. **时间有效性**: $t_{drop} + \Delta t_{delay} \le t_i < t_{drop} + \Delta t_{delay} + 20$
2. **空间有效性**: 连接导弹位置 $\vec{P}_{missile}(t_i)$ 与真目标关键点 $\vec{P}_{target}$ 的线段，与以 $\vec{P}_{cloud}(t_i, \vec{x})$ 为球心、半径 $R_{smoke}=10$m 的球体**相交**。

##### **4.3 约束条件 (Constraints)**

决策变量的取值必须在题目规定的物理限制范围内：

$$
\begin{align*}
70 &\le v \le 140 && \text{(速度约束)} \\
0 &\le \alpha < 360 && \text{(方向约束)} \\
t_{drop} &\ge 0.1 && \text{(投放时间约束, 设一个小的正下界避免奇异)} \\
\Delta t_{delay} &\ge 0.1 && \text{(引信延迟约束, 设一个小的正下界)}
\end{align*}
$$

#### **5. 模型求解方法**

该模型的目标函数 $f(\vec{x})$ 是一个通过仿真计算的“黑箱”函数，无解析表达式且非凸。因此，我们采用**差分进化算法 (Differential Evolution, DE)** 这一全局优化算法进行求解。

**a) 算法原理**: 差分进化算法通过模拟生物进化过程中的**变异(Mutation)**、**交叉(Crossover)**和**选择(Selection)**机制，在解空间中进行全局搜索。

**b) 核心数学公式**:

* **初始化**: 随机生成一个包含 $N_p$ 个候选解（策略）的种群 $P_G = \{\vec{x}_{1,G}, \dots, \vec{x}_{N_p,G}\}$。
* **变异**: 为每个个体 $\vec{x}_{i,G}$，通过种群内其他个体的差异向量生成一个变异向量 $\vec{v}_{i,G+1}$：
  $$
  \vec{v}_{i,G+1} = \vec{x}_{r1,G} + F \cdot (\vec{x}_{r2,G} - \vec{x}_{r3,G})
  $$
* **交叉**: 将变异向量 $\vec{v}_{i,G+1}$ 与其父代 $\vec{x}_{i,G}$ 按交叉概率 $CR$ 混合，生成试验向量 $\vec{u}_{i,G+1}$。
* **选择**: 比较试验向量和父代的优劣。由于我们的目标是最大化 $f(\vec{x})$，选择规则为：
  $$
  \vec{x}_{i,G+1} =
  \begin{cases}
  \vec{u}_{i,G+1}, & \text{if } f(\vec{u}_{i,G+1}) > f(\vec{x}_{i,G}) \\
  \vec{x}_{i,G}, & \text{otherwise}
  \end{cases}
  $$
* **终止**: 算法经过多代进化后，输出种群中 $f(\vec{x})$ 值最大的个体 $\vec{x}^*$ 作为最优策略。最终，根据 $\vec{x}^*$ 计算出题目要求的具体投放点和起爆点坐标。

**选择 (Selection) 过程的详细说明**

在生成了一个新的“试验向量”（或称“子代”） $\vec{u}_{i,G+1}$ 之后，我们需要决定它是否有资格进入下一代种群。评判的标准很简单：**比它的“父代”$\vec{x}_{i,G}$更优秀**。

我们的“优秀”标准，就是**目标函数 $f(\vec{x})$ 的值更大**（即有效遮蔽总时长 $T_{total}$ 更长）。

**公式解读:**

* **`if` 条件**: 我们分别计算试验向量 $\vec{u}_{i,G+1}$ 和其父代向量 $\vec{x}_{i,G}$ 对应的目标函数值（即遮蔽时长）。如果新生成的子代 $\vec{u}_{i,G+1}$ 带来的遮蔽时长 $f(\vec{u}_{i,G+1})$ **大于** 父代 $\vec{x}_{i,G}$ 的遮蔽时长 $f(\vec{x}_{i,G})$，说明发生了一次成功的“进化”。
* **第一个分支**: 在进化成功的情况下，新的子代 $\vec{u}_{i,G+1}$ 将**取代**其父代，成为下一代种群 $P_{G+1}$ 中的一员。
* **第二个分支**: 如果子代的表现**不如或等于**父代，那么这次进化是失败的。父代 $\vec{x}_{i,G}$ 将**继续存活**，并直接进入下一代种群。

通过这个简单的“一对一”竞争机制，种群的平均“优秀程度”将在每一代中都趋向于提升或保持不变，从而逐步向全局最优解逼近。






差分进化算法计算演示算法是如何处理我们这4个决策变量的。

---

### **DE 算法在问题二场景下的计算演示**

**问题设定:**

* **决策变量**: `x = [v, alpha, t_drop, detonation_delay]`
* **边界**: `v`:, `alpha`:, `t_drop`:[0.1,30], `det_delay`:[0.1,15]
* **目标函数**: `evaluate_strategy(x)` -> 返回 `-T_total`
* **算法参数**: 种群大小 `Np = 4`, 缩放因子 `F = 0.5`, 交叉概率 `CR = 0.9`

---

#### **第0步：初始化种群 (第 G=0 代)**

算法在边界内随机生成4组策略。

* **个体1 (问题一策略)**: `x_1,0` = `[120.0, 180.0, 1.5, 3.6]`
  * `evaluate_strategy(x_1,0)` -> 返回 `-1.4` (即 $T_{total} \approx 1.4$s)
* **个体2 (随机策略A)**: `x_2,0` = `[85.0, 90.0, 10.0, 5.0]`
  * `evaluate_strategy(x_2,0)` -> 假设返回 `-2.1` ($T_{total} \approx 2.1$s)
* **个体3 (随机策略B)**: `x_3,0` = `[135.0, 270.0, 5.0, 8.0]`
  * `evaluate_strategy(x_3,0)` -> 假设返回 `-3.5` ($T_{total} \approx 3.5$s)
* **个体4 (随机策略C)**: `x_4,0` = `[75.0, 0.0, 15.0, 2.0]`
  * `evaluate_strategy(x_4,0)` -> 假设返回 `-0.8` ($T_{total} \approx 0.8$s)

目前，种群中最好的个体是 `x_3,0`，其评分为 `-3.5`。

---

#### **第1步：为个体 `x_1,0` (问题一策略) 创造后代**

**A. 变异 (Mutation)**

1. **随机挑选**: 从剩下的3个个体 (`x_2,0`, `x_3,0`, `x_4,0`) 中，不重复地随机挑选3个。

   * 假设随机挑到: `r1=3`, `r2=2`, `r3=4`。
   * 对应的个体是:
     * `x_r1` = `x_3,0` = `[135.0, 270.0, 5.0, 8.0]` (当前最优个体)
     * `x_r2` = `x_2,0` = `[85.0, 90.0, 10.0, 5.0]`
     * `x_r3` = `x_4,0` = `[75.0, 0.0, 15.0, 2.0]`
2. **计算差异向量**:
   `x_r2 - x_r3` = `[85-75, 90-0, 10-15, 5-2]`
   = `[10.0, 90.0, -5.0, 3.0]`
3. **应用变异公式**: `v = x_r1 + F * (x_r2 - x_r3)`
   `v_1,1` = `[135.0, 270.0, 5.0, 8.0] + 0.5 * [10.0, 90.0, -5.0, 3.0]`
   = `[135.0, 270.0, 5.0, 8.0] + [5.0, 45.0, -2.5, 1.5]`
   = `[140.0, 315.0, 2.5, 9.5]`

   我们得到了一个“变异向量” `v_1,1 = [140.0, 315.0, 2.5, 9.5]`。
   *这个变异向量有很强的指导性：它在当前最优解 `x_3,0` 的基础上，增加了一个来自其他两个个体差异的扰动。*

**B. 交叉 (Crossover)**

现在，我们将“变异向量” `v_1,1 = [140.0, 315.0, 2.5, 9.5]` 和它的“父代” `x_1,0 = [120.0, 180.0, 1.5, 3.6]` 进行交叉，生成“试验向量” `u_1,1`。

1. **逐维判断**:

   * **第1维 (速度 `v`)**: `rand_1 = 0.2` (<= 0.9), 采纳**变异值**: `140.0`
   * **第2维 (角度 `alpha`)**: `rand_2 = 0.7` (<= 0.9), 采纳**变异值**: `315.0`
   * **第3维 (投放时间 `t_drop`)**: `rand_3 = 0.98` (> 0.9), 保留**父代值**: `1.5`
   * **第4维 (引信延迟 `det_delay`)**: `rand_4 = 0.5` (<= 0.9), 采纳**变异值**: `9.5`
2. **生成试验向量**:
   `u_1,1` = `[140.0, 315.0, 1.5, 9.5]`
3. **边界检查**: `u_1,1` 的所有值都在各自的边界范围内，OK。

**C. 选择 (Selection)**

1. **计算新个体的适应度**: 我们调用 `evaluate_strategy(u_1,1)`。
   `evaluate_strategy([140.0, 315.0, 1.5, 9.5])`
   *这是一个全新的策略：高速飞行，朝向第四象限，很早投弹，但引信时间很长。*
   -> 假设经过完整的仿真计算，返回的结果是 `-4.1` (即 $T_{total} \approx 4.1$s)。
2. **进行比较**:

   * 新个体的得分: `evaluate_strategy(u_1,1)` = `-4.1`
   * 父代的得分: `evaluate_strategy(x_1,0)` = `-1.4`
3. **做出决定**:
   因为 `-4.1 < -1.4`，新个体**更优秀**！
   所以，在下一代种群 `P_1` 中，第一个个体将是这个新策略：
   **`x_1,1` = `[140.0, 315.0, 1.5, 9.5]`**

---

### **演示总结**

我们刚刚完整地手动计算了**一代进化中的一个步骤**。算法接下来会：

1. 继续为 `x_2,0`, `x_3,0`, `x_4,0` 分别创造它们的后代，形成完整的下一代种群 `P_1`。
2. 然后，以 `P_1` 为基础，重复整个过程，去创造 `P_2`...
3. 经过几十上百代这样的优胜劣汰，种群中最好的那个个体的适应度值（`-T_total`）会越来越小，最终收敛，我们就找到了问题的最优解。
