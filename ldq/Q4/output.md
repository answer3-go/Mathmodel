基于第三问的最优六维解作为原始种子效果较一般

数学建模问题A - 问题四求解器 (PSO版)
====================================

[初始化阶段] 正在向初始种群注入基于问题三最优解的种子...

- 构造的10维种子策略: [80.8599 10.9027  0.1    80.8599 10.9027  1.1    80.8599 10.9027 11.1
  0.106 ]
  PSO初始化完成，初始种群最优得分: 3.3700 s
  开始迭代寻优...
  迭代 10/300, 当前最优遮蔽时长: 4.8100 s
  迭代 20/300, 当前最优遮蔽时长: 4.8200 s
  迭代 30/300, 当前最优遮蔽时长: 4.8200 s
  迭代 40/300, 当前最优遮蔽时长: 4.8200 s
  迭代 50/300, 当前最优遮蔽时长: 4.8200 s
  迭代 60/300, 当前最优遮蔽时长: 4.8200 s
  迭代 70/300, 当前最优遮蔽时长: 4.8200 s
  迭代 80/300, 当前最优遮蔽时长: 4.8200 s
  迭代 90/300, 当前最优遮蔽时长: 4.8200 s
  迭代 100/300, 当前最优遮蔽时长: 4.8200 s
  迭代 110/300, 当前最优遮蔽时长: 4.8200 s
  迭代 120/300, 当前最优遮蔽时长: 4.8200 s
  迭代 130/300, 当前最优遮蔽时长: 4.8200 s
  迭代 140/300, 当前最优遮蔽时长: 4.8200 s
  迭代 150/300, 当前最优遮蔽时长: 4.8200 s
  迭代 160/300, 当前最优遮蔽时长: 4.8200 s
  迭代 170/300, 当前最优遮蔽时长: 4.8200 s
  迭代 180/300, 当前最优遮蔽时长: 4.8200 s
  迭代 190/300, 当前最优遮蔽时长: 4.8200 s
  迭代 200/300, 当前最优遮蔽时长: 4.8200 s
  迭代 210/300, 当前最优遮蔽时长: 4.8200 s
  迭代 220/300, 当前最优遮蔽时长: 4.8200 s
  迭代 230/300, 当前最优遮蔽时长: 4.8200 s
  迭代 240/300, 当前最优遮蔽时长: 4.8200 s
  迭代 250/300, 当前最优遮蔽时长: 4.8200 s
  迭代 260/300, 当前最优遮蔽时长: 4.8200 s
  迭代 270/300, 当前最优遮蔽时长: 4.8200 s
  迭代 280/300, 当前最优遮蔽时长: 4.8200 s
  迭代 290/300, 当前最优遮蔽时长: 4.8200 s
  迭代 300/300, 当前最优遮蔽时长: 4.8200 s

寻优完成！

- 总耗时: 955.02 秒

==================== 问题四最优策略 ====================

  [+] 统一引信延迟 (det_delay): 0.8502 s

  [+] 各无人机最优策略及物理状态:
    --- 无人机 FY1 ---
      - 飞行速度: 92.85 m/s, 飞行方向: 7.27 度
      - 投放时刻: 0.10 s
      - 投放点坐标: [17809.21, 1.17, 1800.00] m
      - 起爆时刻: 0.95 s
      - 起爆点坐标: [17887.52, 11.16, 1796.46] m
    --- 无人机 FY2 ---
      - 飞行速度: 88.69 m/s, 飞行方向: 0.00 度
      - 投放时刻: 27.88 s
      - 投放点坐标: [14473.14, 1400.00, 1400.00] m
      - 起爆时刻: 28.73 s
      - 起爆点坐标: [14548.55, 1400.00, 1396.46] m
    --- 无人机 FY3 ---
      - 飞行速度: 119.64 m/s, 飞行方向: 228.11 度
      - 投放时刻: 38.71 s
      - 投放点坐标: [2908.06, -6447.59, 700.00] m
      - 起爆时刻: 39.56 s
      - 起爆点坐标: [2840.15, -6523.31, 696.46] m

  [+] 最终优化结果:
      - 在此三机协同策略下，对导弹M1的最大有效遮蔽时长为: 4.8200 秒

==========================================================


**分析：因为三架无人机的初始位置完全不同，我们**绝对不能**再简单地沿用之前基于单架无人机（FY1）得出的最优参数作为种子**



为每个无人机定制参数的种子生成器

种子生成器的核心逻辑与优势

**核心逻辑**:
不再是盲目模仿，而是**“目标驱动，路径反算”**。我们首先确定一个所有人都认可的、最优的**“会合点”**（即烟幕应该在哪里形成），然后为每一架无人机**独立地**规划出一条从**它自己的**初始位置出发、能够最高效到达这个会合点的专属路径。

**逻辑优势**:

1. **目标导向，逻辑自洽**: 整个策略的生成，都是围绕着“如何最高效地在关键点形成协同”这个唯一目标展开的，每一步都有明确的物理和几何意义。
2. **承认并利用差异**: 它充分承认了三架无人机初始位置不同的事实，并将这种差异作为路径规划的**输入**，而不是一个需要忽略的麻烦。
3. **高度可解释**: 我们可以清晰地解释为什么为FY1、FY2、FY3分别规划了不同的飞行策略——因为这是它们各自到达共同战术目标点的**最优路径**。

---

### **3. 核心数学公式与计算步骤**

下面，我们详细拆解 `generate_q4_seed_strategy_tailored()` 函数中的每一步，并给出其对应的数学公式。

#### **Step 1: 确定“标杆”任务点**

* **目的**: 找到一个理想的、由问题三验证过的高价值拦截区域。
* **做法**: 我们继承问题三最优解中，由FY1执行三次投放所形成的三个**起爆点**位置。这三个点代表了一个经过优化的、时空上有协同关系的拦截点序列。我们选择**第一个起爆点**作为我们这次协同作战的**主要汇合目标点**。
* **数学公式**:
  $$
  \vec{P}_{target\_point} = \text{model.get\_detonation\_pos}(\vec{P}_{uav\_start,1}, \vec{v}_{uav,q3}, t_{drop1,q3}, \Delta t_{delay,q3})
  $$

  其中，下标 `q3` 代表问题三的最优解参数，`uav_start,1` 代表FY1的初始位置。

#### **Step 2: 为每架无人机“量体裁衣”规划路径**

* **目的**: 为每一架无人机 $j \in \{1, 2, 3\}$，独立计算出一条从其初始位置 $\vec{P}_{uav\_start, j}$ 飞向目标点 $\vec{P}_{target\_point}$ 的最优路径。
* **做法**:
  1. **计算航向向量**:
     $$
     \vec{d}_{j} = \vec{P}_{target\_point} - \vec{P}_{uav\_start, j}
     $$
  2. **确定最优飞行方向 $\alpha_{seed, j}$**: 航向向量在XY平面的投影，其与X轴的夹角就是最佳飞行方向。
     $$
     \alpha_{seed, j} = \text{atan2}(d_{j,y}, d_{j,x})
     $$

     其中 `atan2` 是能处理四个象限的反正切函数。
  3. **确定最优飞行速度 $v_{seed, j}$**: 为了最快到达，我们让每一架无人机都采用其最大飞行速度。
     $$
     v_{seed, j} = v_{max} = 140 \text{ m/s}
     $$
  4. **估算最短飞行时间 $t_{fly, j}$**:
     $$
     t_{fly, j} = \frac{||\vec{d}_{j}||}{v_{seed, j}}
     $$
  5. **计算投放时刻 $t_{drop, j}$**: 为了在到达目标点时正好引爆，需要提前一个引信延迟的时间进行投放。
     $$
     t_{drop, j} = \max(0.1, t_{fly, j} - \Delta t_{delay, base})
     $$

     其中 $\Delta t_{delay, base}$ 是我们从问题三继承的优秀引信延迟。`max(0.1, ...)`确保了投放时间不为负。

#### **Step 3: 组装最终的10维种子**

* **目的**: 将三套“量体裁衣”的专属策略，与一个统一的规则（引信延迟）结合起来，形成一个完整的协同方案。
* **做法**: 将计算出的结果按顺序拼接。
  $$
  \vec{x}_{seed} = [
  \underbrace{v_{seed,1}, \alpha_{seed,1}, t_{drop,1}}_{\text{为FY1量身定做的策略}},
  \underbrace{v_{seed,2}, \alpha_{seed,2}, t_{drop,2}}_{\text{为FY2量身定做的策略}},
  \underbrace{v_{seed,3}, \alpha_{seed,3}, t_{drop,3}}_{\text{为FY3量身定做的策略}},
  \underbrace{\Delta t_{delay, base}}_{\text{继承自Q3的统一引信}}
  ]
  $$
* **逻辑修正与增强**: 上述步骤生成的投放时间是“各自最快到达”的时间。为了更好地体现问题三的“协同节奏”，我们在最终代码中做了一个增强：**以最快的无人机到达时间为基准，让其他无人机按照问题三的时间间隔 `dt2, dt3` 依次投放**。这使得种子不仅路径最优，而且节奏也最优。


|  |  |  |
| :- | :- | :- |
