### **问题三：最优三枚烟幕弹投放策略建模**

#### **1. 问题重述**

本问题的核心目标是：利用单架无人机（FY1）投放**三枚**烟幕弹对抗来袭的导弹（M1），设计一套包含**无人机飞行策略**和**三枚烟幕弹各自投放与起爆时机**的完整方案，使得这三枚烟幕弹对真目标的**有效遮蔽总时长达到最大**。

**关键变化**:

* 从投放1枚弹变为投放3枚弹。
* 需要考虑3枚弹之间的**时空协同**问题。
* 每两枚弹的投放间隔**至少为1秒**。

#### **2. 核心思路**

我们的核心思路依然是构建一个**“寻优求解引擎”**来驱动**“基础模型”**的优化过程。但现在，我们需要对**决策变量**和**策略评价函数**进行扩展，以适应多烟幕弹的场景。

1. **扩展决策变量**: 我们的策略需要描述更复杂的行动。原来描述1枚弹需要4个参数，现在描述3枚弹，就需要更多的参数。
2. **升级评价函数**: 我们的 `evaluate_strategy`函数，在计算总遮蔽时长时，必须能够同时考虑**所有**有效的烟幕云所产生的遮蔽效果。
3. **复用优化算法**: 寻优求解引擎（例如我们已经打磨好的增强型PSO）的核心算法**无需改变**，因为它只关心如何优化一个给定的决策向量，不关心这个向量具体代表什么。

#### **3. 模型建立与求解流程**

##### **3.1 决策变量 (Decision Variables)**

如何用最少的参数，完整地描述一个投放3枚烟幕弹的策略？这是一个关键的建模选择。

* **无人机飞行策略**: 依然由速度大小 $v$ 和方向角 $\alpha$ 两个参数决定。我们假设无人机一旦确定航向和速度就不再改变。
* **多弹投放时序**: 我们需要定义3次投放和3次起爆。最经济的描述方式是：
  * 第一次投放的时刻：$t_{drop1}$
  * 第二次投放相对于第一次的**时间间隔**: $\Delta t_{drop2}$
  * 第三次投放相对于第二次的**时间间隔**: $\Delta t_{drop3}$
  * 我们假设所有烟幕弹使用相同的引信设置，即拥有一个统一的**引信延迟时间**: $\Delta t_{delay}$。这既符合工程实际，也大大减少了决策变量的数量。

因此，我们的决策变量向量 $\vec{x}$ 从4维扩展到了**6维**：

$$
\vec{x} = [v, \alpha, t_{drop1}, \Delta t_{drop2}, \Delta t_{drop3}, \Delta t_{delay}]
$$

##### **3.2 目标函数 (Objective Function)**

我们的目标函数 $f(\vec{x})$ 依然是计算给定策略 $\vec{x}$ 下的总遮蔽时长 $T_{total}(\vec{x})$。

$$
\text{Maximize: } f(\vec{x}) = T_{total}(\vec{x}) \approx \sum_{i=0}^{N} V(t_i, \vec{x}) \cdot \Delta t
$$

关键在于，瞬时遮蔽状态函数 $V(t, \vec{x})$ 的定义需要升级。

* **升级后的瞬时遮蔽状态函数**:
  在任意时刻 $t$，只要**至少有一个**有效的烟幕云形成了遮蔽，那么该时刻就被视为“已遮蔽”。

  $$
  V(t, \vec{x}) =
  \begin{cases}
  1, & \text{if } (\text{IsVeiledByCloud}_1(t, \vec{x})) \lor (\text{IsVeiledByCloud}_2(t, \vec{x})) \lor (\text{IsVeiledByCloud}_3(t, \vec{x})) \\
  0, & \text{otherwise}
  \end{cases}
  $$

  * $\lor$ 是逻辑“或”运算符。
  * $\text{IsVeiledByCloud}_j(t, \vec{x})$ 是一个布尔函数，判断第 $j$ 枚烟幕弹在时刻 $t$ 是否形成了有效遮蔽。它的计算逻辑与问题二中的 $V(t,\vec{x})$ 完全相同，需要**调用时空运动模型**和**遮蔽判定模型**。
* **计算第 $j$ 枚烟幕弹的状态**:
  为了计算 $\text{IsVeiledByCloud}_j$，我们需要先确定每一枚弹的投放和起爆时刻：

  * **投放时刻**:
    * $t_{drop,1} = t_{drop1}$
    * $t_{drop,2} = t_{drop1} + \Delta t_{drop2}$
    * $t_{drop,3} = t_{drop1} + \Delta t_{drop2} + \Delta t_{drop3}$
  * **起爆时刻**:
    * $t_{detonate,j} = t_{drop,j} + \Delta t_{delay}$
  * **起爆点位置**:
    * 第 $j$ 枚烟幕弹的起爆点 $\vec{P}_{detonate,j}(\vec{x})$ 需要**调用时空运动模型**，使用其对应的投放时刻 $t_{drop,j}$ 来计算。
  * **云心位置**:
    * 第 $j$ 枚烟幕云在时刻 $t$ 的位置 $\vec{P}_{cloud,j}(t, \vec{x})$ 也需要使用其对应的起爆参数来计算。

##### **3.3 约束条件 (Constraints)**

决策变量的约束变得更加复杂：

$$
\begin{align*}
70 &\le v \le 140 && \text{(速度约束)} \\
0 &\le \alpha < 360 && \text{(方向约束)} \\
t_{drop1} &\ge 0.1 && \text{(首次投放时间约束)} \\
\Delta t_{drop2} &\ge 1.0 && \text{(投放间隔约束)} \\
\Delta t_{drop3} &\ge 1.0 && \text{(投放间隔约束)} \\
\Delta t_{delay} &\ge 0.1 && \text{(引信延迟约束)}
\end{align*}
$$

同时，我们还需要为 $t_{drop1}, \Delta t_{drop2}, \Delta t_{drop3}, \Delta t_{delay}$ 设置合理的上限，以限定搜索空间。

#### **4. 模型求解方法**

我们继续使用经过优化的**增强型粒子群优化算法 (Enhanced PSO)**。

* **算法适应性**: PSO算法天然支持更高维度的决策变量。我们只需要将粒子的维度从4维扩展到6维，算法的核心数学公式（速度和位置更新）**完全无需改变**。
* **初始化**:
  * 在新的6维边界内随机生成粒子。
  * **启发式种子注入**: 我们可以将**问题二的最优解**进行扩展，作为问题三的一个“种子选手”。例如，我们可以构造一个策略，让第二、三枚弹在第一枚弹的基础上，以某个固定的间隔（如5秒）投放，形成一个初始的、有一定协同性的策略，并将其植入初始种群。
* **迭代与评估**: 算法的迭代流程保持不变。在每一步评估中，我们调用**升级后**的 `evaluate_strategy_q3(x)`函数。该函数内部会模拟三枚烟幕弹的完整过程，并根据“逻辑或”的原则计算总的遮蔽时长。
* **结果输出**: 算法终止后，输出的最优6维向量 $\vec{x}^*$ 就对应了我们问题三的最优策略。我们再根据 $\vec{x}^*$ 计算出每一枚烟幕弹具体的投放点、起爆点坐标，以及总的遮蔽时长。
